//
//  DatePickerManager.m
//  DatePicker
//
//  Created by topjoy on 2019/10/29.
//  Copyright Â© 2019 Facebook. All rights reserved.
//

#import "DatePickerManager.h"

#import <React/RCTConvert.h>

#import "RCTConvert+DatePickerMode.h"




@implementation DatePickerManager

RCT_EXPORT_MODULE(DatePicker)

RCT_EXPORT_VIEW_PROPERTY(onValueChanged, RCTDirectEventBlock)
- (UIView *)view {
    
    self.datePicker = [[DatePicker alloc] init];
    [self.datePicker addTarget: self action: @selector(didDateChanged:) forControlEvents: UIControlEventValueChanged];
    return self.datePicker;
}


RCT_CUSTOM_VIEW_PROPERTY(mode, UIDatePickerMode, UIDatePicker)
{
    view.datePickerMode = [RCTConvert UIDatePickerMode: json];
}

- (NSDictionary *)constantsToExport
{
    return @{
        @"datePickerModeTime": @(UIDatePickerModeTime),
        @"datePickerModeDate": @(UIDatePickerModeDate),
        @"datePickerModeDateAndTime": @(UIDatePickerModeDateAndTime),
        @"datePickerModeCountDownTimer": @(UIDatePickerModeCountDownTimer)
    };
}

- (void) didDateChanged: (id) sender
{
    DatePicker* datePicker = sender;
    NSDateFormatter * formatter = [[NSDateFormatter alloc] init];
    [formatter setDateFormat: @"HH:mm"];
    NSString * stringFromDate = [formatter stringFromDate: datePicker.date];
    NSLog(@"%@", stringFromDate);
    if (datePicker.onValueChanged) {
        datePicker.onValueChanged(@{
            @"date": stringFromDate
        });
    }
}
@end
